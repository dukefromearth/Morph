// Dependencies.
/*jshint esversion: 6 *///
import express from 'express';
import http from 'http';
import path from 'path';
import socketIO from 'socket.io';
import Game from './server/game.mjs';
import { MAP_SIZE } from './shared/constants.mjs';

const __dirname = path.resolve(path.dirname(''));
const map_size = MAP_SIZE;
const HOST = process.env.HOST || '0.0.0.0';
const environment = process.env.ENV || "prod";
const game = new Game(map_size, map_size);
var num_users = 0;
const app = express();
const server = http.Server(app);
const io = socketIO(server);
const refresh_rate = 1000 / 60;
const port_num = 5000;

app.set('port', port_num);
app.use('/client', express.static('./client'));
app.use('/shared', express.static('./shared'))

// Routing
app.get('/', function (request, response) {
  response.sendFile(path.join(__dirname, '/index.html'));
});

app.get('/call', function(request, response){
  fetch('http://localhost:5001/call', { method: 'GET'})
    .then(res => res.json()) // expecting a json response
    .then(json => {
      console.log(json)
      return json
    });
})
server.listen(port_num, function () {
  console.log(`Running as ${environment} environment`);
  console.log('Starting server on port', port_num);
});

io.on('connection', function (socket) {
  num_users++;
  socket.on('new player', function () {
    game.new_player(socket.id);
  });

  socket.on('disconnect', function () {
    game.delete_player(socket.id);
    num_users--;
  });

  socket.on('movement', function (data) {
    game.update_player_pos(socket.id, data);
  });
  
  socket.on('shoot-bomb', function () {
    game.new_bomb(socket.id);
  });

});

// right 
var dir1_bank = [
  [{"x47y46":{"x":47,"y":46},"x49y49":{"x":49,"y":49},"x53y51":{"x":53,"y":51},"x48y53":{"x":48,"y":53},"x51y52":{"x":51,"y":52},"x52y49":{"x":52,"y":49},"x48y47":{"x":48,"y":47},"x46y48":{"x":46,"y":48},"x48y52":{"x":48,"y":52},"x52y51":{"x":52,"y":51},"x48y49":{"x":48,"y":49},"x48y46":{"x":48,"y":46},"x47y47":{"x":47,"y":47},"x46y49":{"x":46,"y":49},"x51y47":{"x":51,"y":47},"x52y52":{"x":52,"y":52},"x46y53":{"x":46,"y":53},"x47y51":{"x":47,"y":51},"x47y49":{"x":47,"y":49},"x50y49":{"x":50,"y":49},"x53y52":{"x":53,"y":52}}],
  [{"x49y47":{"x":49,"y":47},"x50y53":{"x":50,"y":53},"x50y52":{"x":50,"y":52},"x48y46":{"x":48,"y":46},"x53y49":{"x":53,"y":49},"x50y49":{"x":50,"y":49},"x48y50":{"x":48,"y":50},"x46y53":{"x":46,"y":53},"x49y51":{"x":49,"y":51},"x47y53":{"x":47,"y":53},"x49y48":{"x":49,"y":48},"x52y52":{"x":52,"y":52},"x49y52":{"x":49,"y":52},"x53y51":{"x":53,"y":51},"x47y46":{"x":47,"y":46},"x52y51":{"x":52,"y":51},"x53y53":{"x":53,"y":53},"x48y49":{"x":48,"y":49},"x51y49":{"x":51,"y":49},"x51y52":{"x":51,"y":52},"x46y48":{"x":46,"y":48}}],
  [{"x51y48":{"x":51,"y":48},"x48y52":{"x":48,"y":52},"x46y53":{"x":46,"y":53},"x49y48":{"x":49,"y":48},"x51y53":{"x":51,"y":53},"x46y46":{"x":46,"y":46},"x49y50":{"x":49,"y":50},"x47y49":{"x":47,"y":49},"x53y51":{"x":53,"y":51},"x50y48":{"x":50,"y":48},"x48y46":{"x":48,"y":46},"x46y48":{"x":46,"y":48},"x49y46":{"x":49,"y":46},"x46y51":{"x":46,"y":51},"x51y49":{"x":51,"y":49},"x49y53":{"x":49,"y":53},"x48y49":{"x":48,"y":49},"x49y51":{"x":49,"y":51},"x52y53":{"x":52,"y":53},"x52y49":{"x":52,"y":49},"x51y52":{"x":51,"y":52},"x52y48":{"x":52,"y":48}}],
  [{"x47y48":{"x":47,"y":48},"x52y52":{"x":52,"y":52},"x47y49":{"x":47,"y":49},"x49y53":{"x":49,"y":53},"x48y51":{"x":48,"y":51},"x53y53":{"x":53,"y":53},"x50y52":{"x":50,"y":52},"x49y52":{"x":49,"y":52},"x52y48":{"x":52,"y":48},"x46y53":{"x":46,"y":53},"x52y51":{"x":52,"y":51},"x49y48":{"x":49,"y":48},"x51y51":{"x":51,"y":51},"x47y50":{"x":47,"y":50},"x53y51":{"x":53,"y":51},"x52y50":{"x":52,"y":50},"x48y53":{"x":48,"y":53},"x53y50":{"x":53,"y":50},"x53y46":{"x":53,"y":46},"x49y47":{"x":49,"y":47},"x47y47":{"x":47,"y":47}}]
]

// down right
var dir2_bank = [
  [{"x46y49":{"x":46,"y":49},"x53y48":{"x":53,"y":48},"x50y53":{"x":50,"y":53},"x50y52":{"x":50,"y":52},"x49y50":{"x":49,"y":50},"x53y47":{"x":53,"y":47},"x49y51":{"x":49,"y":51},"x53y52":{"x":53,"y":52},"x47y52":{"x":47,"y":52},"x51y52":{"x":51,"y":52},"x51y51":{"x":51,"y":51},"x49y53":{"x":49,"y":53},"x50y46":{"x":50,"y":46},"x51y53":{"x":51,"y":53},"x53y49":{"x":53,"y":49},"x52y49":{"x":52,"y":49},"x51y46":{"x":51,"y":46},"x48y49":{"x":48,"y":49},"x49y52":{"x":49,"y":52},"x46y53":{"x":46,"y":53},"x52y47":{"x":52,"y":47},"x46y48":{"x":46,"y":48},"x46y46":{"x":46,"y":46}}],
  [{"x50y48":{"x":50,"y":48},"x49y46":{"x":49,"y":46},"x49y49":{"x":49,"y":49},"x51y48":{"x":51,"y":48},"x53y49":{"x":53,"y":49},"x52y53":{"x":52,"y":53},"x46y50":{"x":46,"y":50},"x47y50":{"x":47,"y":50},"x50y47":{"x":50,"y":47},"x47y49":{"x":47,"y":49},"x53y53":{"x":53,"y":53},"x46y52":{"x":46,"y":52},"x49y53":{"x":49,"y":53},"x47y51":{"x":47,"y":51},"x48y53":{"x":48,"y":53},"x52y49":{"x":52,"y":49},"x47y47":{"x":47,"y":47},"x52y48":{"x":52,"y":48},"x51y53":{"x":51,"y":53},"x52y51":{"x":52,"y":51},"x51y46":{"x":51,"y":46},"x46y49":{"x":46,"y":49},"x46y47":{"x":46,"y":47},"x50y46":{"x":50,"y":46}}],
  [{"x47y48":{"x":47,"y":48},"x49y51":{"x":49,"y":51},"x51y52":{"x":51,"y":52},"x50y47":{"x":50,"y":47},"x50y52":{"x":50,"y":52},"x46y52":{"x":46,"y":52},"x53y52":{"x":53,"y":52},"x49y49":{"x":49,"y":49},"x52y46":{"x":52,"y":46},"x46y53":{"x":46,"y":53},"x47y52":{"x":47,"y":52},"x46y48":{"x":46,"y":48},"x48y50":{"x":48,"y":50},"x51y51":{"x":51,"y":51},"x46y46":{"x":46,"y":46},"x52y51":{"x":52,"y":51},"x50y51":{"x":50,"y":51},"x49y48":{"x":49,"y":48},"x50y53":{"x":50,"y":53},"x50y46":{"x":50,"y":46}}]
]
// down
var dir3_bank = [
  [{"x52y51":{"x":52,"y":51},"x48y51":{"x":48,"y":51},"x49y51":{"x":49,"y":51},"x51y53":{"x":51,"y":53},"x47y52":{"x":47,"y":52},"x48y53":{"x":48,"y":53},"x50y47":{"x":50,"y":47},"x47y47":{"x":47,"y":47},"x47y53":{"x":47,"y":53},"x48y49":{"x":48,"y":49},"x50y51":{"x":50,"y":51},"x47y48":{"x":47,"y":48},"x52y49":{"x":52,"y":49},"x51y49":{"x":51,"y":49},"x50y52":{"x":50,"y":52},"x49y52":{"x":49,"y":52},"x52y50":{"x":52,"y":50},"x46y52":{"x":46,"y":52},"x53y52":{"x":53,"y":52}}],
  [{"x46y52":{"x":46,"y":52},"x49y48":{"x":49,"y":48},"x47y49":{"x":47,"y":49},"x52y49":{"x":52,"y":49},"x49y51":{"x":49,"y":51},"x53y50":{"x":53,"y":50},"x51y46":{"x":51,"y":46},"x46y46":{"x":46,"y":46},"x49y50":{"x":49,"y":50},"x53y53":{"x":53,"y":53},"x48y53":{"x":48,"y":53},"x51y53":{"x":51,"y":53},"x49y49":{"x":49,"y":49},"x47y46":{"x":47,"y":46},"x50y51":{"x":50,"y":51},"x53y52":{"x":53,"y":52},"x50y46":{"x":50,"y":46},"x48y52":{"x":48,"y":52},"x48y46":{"x":48,"y":46},"x47y48":{"x":47,"y":48},"x53y49":{"x":53,"y":49}}],
  [{"x47y48":{"x":47,"y":48},"x52y52":{"x":52,"y":52},"x47y49":{"x":47,"y":49},"x49y53":{"x":49,"y":53},"x48y51":{"x":48,"y":51},"x53y53":{"x":53,"y":53},"x50y52":{"x":50,"y":52},"x49y52":{"x":49,"y":52},"x52y48":{"x":52,"y":48},"x46y53":{"x":46,"y":53},"x52y51":{"x":52,"y":51},"x49y48":{"x":49,"y":48},"x51y51":{"x":51,"y":51},"x47y50":{"x":47,"y":50},"x53y51":{"x":53,"y":51},"x52y50":{"x":52,"y":50},"x48y53":{"x":48,"y":53},"x53y50":{"x":53,"y":50},"x53y46":{"x":53,"y":46},"x49y47":{"x":49,"y":47},"x47y47":{"x":47,"y":47}}]
]
// down left
var dir4_bank = [
  [{"x53y46":{"x":53,"y":46},"x52y47":{"x":52,"y":47},"x48y53":{"x":48,"y":53},"x48y52":{"x":48,"y":52},"x48y46":{"x":48,"y":46},"x53y47":{"x":53,"y":47},"x53y51":{"x":53,"y":51},"x48y49":{"x":48,"y":49},"x50y48":{"x":50,"y":48},"x48y50":{"x":48,"y":50},"x47y49":{"x":47,"y":49},"x51y47":{"x":51,"y":47},"x51y50":{"x":51,"y":50},"x49y47":{"x":49,"y":47},"x46y51":{"x":46,"y":51},"x50y53":{"x":50,"y":53},"x50y52":{"x":50,"y":52},"x47y52":{"x":47,"y":52},"x53y50":{"x":53,"y":50},"x49y51":{"x":49,"y":51},"x49y48":{"x":49,"y":48},"x50y50":{"x":50,"y":50}}],
  [{"x47y52":{"x":47,"y":52},"x48y47":{"x":48,"y":47},"x51y47":{"x":51,"y":47},"x48y48":{"x":48,"y":48},"x50y52":{"x":50,"y":52},"x46y48":{"x":46,"y":48},"x49y46":{"x":49,"y":46},"x48y53":{"x":48,"y":53},"x49y48":{"x":49,"y":48},"x50y51":{"x":50,"y":51},"x50y46":{"x":50,"y":46},"x53y47":{"x":53,"y":47},"x47y51":{"x":47,"y":51},"x48y51":{"x":48,"y":51},"x51y48":{"x":51,"y":48},"x48y52":{"x":48,"y":52},"x47y46":{"x":47,"y":46},"x53y50":{"x":53,"y":50},"x51y49":{"x":51,"y":49},"x46y46":{"x":46,"y":46},"x53y46":{"x":53,"y":46},"x48y46":{"x":48,"y":46},"x52y47":{"x":52,"y":47}}],
  [{"x52y47":{"x":52,"y":47},"x52y52":{"x":52,"y":52},"x47y46":{"x":47,"y":46},"x50y49":{"x":50,"y":49},"x47y50":{"x":47,"y":50},"x49y46":{"x":49,"y":46},"x47y52":{"x":47,"y":52},"x46y49":{"x":46,"y":49},"x49y51":{"x":49,"y":51},"x53y48":{"x":53,"y":48},"x48y53":{"x":48,"y":53},"x53y47":{"x":53,"y":47},"x48y49":{"x":48,"y":49},"x52y51":{"x":52,"y":51},"x53y53":{"x":53,"y":53},"x53y52":{"x":53,"y":52},"x46y52":{"x":46,"y":52},"x48y50":{"x":48,"y":50},"x46y47":{"x":46,"y":47},"x47y51":{"x":47,"y":51},"x52y49":{"x":52,"y":49}}]
  
]
// left 
var dir5_bank = [
  [{"x48y50":{"x":48,"y":50},"x50y48":{"x":50,"y":48},"x51y48":{"x":51,"y":48},"x48y47":{"x":48,"y":47},"x53y52":{"x":53,"y":52},"x52y51":{"x":52,"y":51},"x49y50":{"x":49,"y":50},"x47y48":{"x":47,"y":48},"x50y49":{"x":50,"y":49},"x49y47":{"x":49,"y":47},"x53y49":{"x":53,"y":49},"x53y46":{"x":53,"y":46},"x51y47":{"x":51,"y":47},"x48y52":{"x":48,"y":52},"x52y52":{"x":52,"y":52},"x51y51":{"x":51,"y":51},"x51y50":{"x":51,"y":50},"x46y46":{"x":46,"y":46},"x52y50":{"x":52,"y":50},"x53y50":{"x":53,"y":50},"x49y53":{"x":49,"y":53},"x53y48":{"x":53,"y":48}}],
  [{"x53y46":{"x":53,"y":46},"x52y47":{"x":52,"y":47},"x48y53":{"x":48,"y":53},"x48y52":{"x":48,"y":52},"x48y46":{"x":48,"y":46},"x53y47":{"x":53,"y":47},"x53y51":{"x":53,"y":51},"x48y49":{"x":48,"y":49},"x50y48":{"x":50,"y":48},"x48y50":{"x":48,"y":50},"x47y49":{"x":47,"y":49},"x51y47":{"x":51,"y":47},"x51y50":{"x":51,"y":50},"x49y47":{"x":49,"y":47},"x46y51":{"x":46,"y":51},"x50y53":{"x":50,"y":53},"x50y52":{"x":50,"y":52},"x47y52":{"x":47,"y":52},"x53y50":{"x":53,"y":50},"x49y51":{"x":49,"y":51},"x49y48":{"x":49,"y":48},"x50y50":{"x":50,"y":50}}],
  [{"x47y49":{"x":47,"y":49},"x46y52":{"x":46,"y":52},"x51y48":{"x":51,"y":48},"x48y51":{"x":48,"y":51},"x49y46":{"x":49,"y":46},"x46y50":{"x":46,"y":50},"x49y47":{"x":49,"y":47},"x48y53":{"x":48,"y":53},"x52y49":{"x":52,"y":49},"x49y52":{"x":49,"y":52},"x51y52":{"x":51,"y":52},"x50y52":{"x":50,"y":52},"x52y53":{"x":52,"y":53},"x47y48":{"x":47,"y":48},"x52y46":{"x":52,"y":46},"x48y49":{"x":48,"y":49},"x52y52":{"x":52,"y":52},"x48y50":{"x":48,"y":50},"x50y50":{"x":50,"y":50},"x46y49":{"x":46,"y":49},"x53y48":{"x":53,"y":48},"x52y50":{"x":52,"y":50},"x52y51":{"x":52,"y":51}}]

]
// up left
var dir6_bank =[
  [{"x50y53":{"x":50,"y":53},"x51y47":{"x":51,"y":47},"x53y51":{"x":53,"y":51},"x50y51":{"x":50,"y":51},"x49y50":{"x":49,"y":50},"x46y50":{"x":46,"y":50},"x52y48":{"x":52,"y":48},"x48y48":{"x":48,"y":48},"x53y47":{"x":53,"y":47},"x51y52":{"x":51,"y":52},"x49y49":{"x":49,"y":49},"x53y52":{"x":53,"y":52},"x48y52":{"x":48,"y":52},"x46y46":{"x":46,"y":46},"x49y48":{"x":49,"y":48},"x53y46":{"x":53,"y":46},"x48y46":{"x":48,"y":46},"x53y50":{"x":53,"y":50},"x46y47":{"x":46,"y":47},"x49y52":{"x":49,"y":52},"x46y53":{"x":46,"y":53},"x47y46":{"x":47,"y":46}}],
  [{"x51y51":{"x":51,"y":51},"x50y47":{"x":50,"y":47},"x48y50":{"x":48,"y":50},"x52y52":{"x":52,"y":52},"x53y47":{"x":53,"y":47},"x46y52":{"x":46,"y":52},"x51y49":{"x":51,"y":49},"x46y50":{"x":46,"y":50},"x48y48":{"x":48,"y":48},"x48y47":{"x":48,"y":47},"x49y51":{"x":49,"y":51},"x49y50":{"x":49,"y":50},"x46y48":{"x":46,"y":48},"x52y49":{"x":52,"y":49},"x47y47":{"x":47,"y":47},"x52y48":{"x":52,"y":48},"x49y46":{"x":49,"y":46},"x53y53":{"x":53,"y":53},"x52y53":{"x":52,"y":53},"x47y52":{"x":47,"y":52},"x53y49":{"x":53,"y":49}}],
  [{"x52y50":{"x":52,"y":50},"x53y47":{"x":53,"y":47},"x49y46":{"x":49,"y":46},"x46y51":{"x":46,"y":51},"x52y49":{"x":52,"y":49},"x49y49":{"x":49,"y":49},"x48y46":{"x":48,"y":46},"x51y46":{"x":51,"y":46},"x51y47":{"x":51,"y":47},"x46y50":{"x":46,"y":50},"x49y53":{"x":49,"y":53},"x53y48":{"x":53,"y":48},"x47y46":{"x":47,"y":46},"x46y52":{"x":46,"y":52},"x51y53":{"x":51,"y":53},"x46y48":{"x":46,"y":48},"x48y53":{"x":48,"y":53},"x50y48":{"x":50,"y":48},"x47y50":{"x":47,"y":50},"x49y48":{"x":49,"y":48},"x47y48":{"x":47,"y":48},"x52y47":{"x":52,"y":47}}]

]
// up
var dir7_bank = [
  [{"x50y49":{"x":50,"y":49},"x48y50":{"x":48,"y":50},"x53y52":{"x":53,"y":52},"x46y46":{"x":46,"y":46},"x53y53":{"x":53,"y":53},"x47y47":{"x":47,"y":47},"x49y50":{"x":49,"y":50},"x47y50":{"x":47,"y":50},"x49y48":{"x":49,"y":48},"x50y53":{"x":50,"y":53},"x49y51":{"x":49,"y":51},"x47y46":{"x":47,"y":46},"x49y49":{"x":49,"y":49},"x46y51":{"x":46,"y":51},"x48y48":{"x":48,"y":48},"x50y48":{"x":50,"y":48},"x46y53":{"x":46,"y":53},"x50y52":{"x":50,"y":52},"x52y50":{"x":52,"y":50},"x47y49":{"x":47,"y":49},"x46y47":{"x":46,"y":47}}],
  [{"x48y51":{"x":48,"y":51},"x49y53":{"x":49,"y":53},"x53y49":{"x":53,"y":49},"x46y50":{"x":46,"y":50},"x51y48":{"x":51,"y":48},"x51y53":{"x":51,"y":53},"x51y47":{"x":51,"y":47},"x53y48":{"x":53,"y":48},"x49y52":{"x":49,"y":52},"x52y52":{"x":52,"y":52},"x52y47":{"x":52,"y":47},"x51y46":{"x":51,"y":46},"x52y53":{"x":52,"y":53},"x52y48":{"x":52,"y":48},"x47y50":{"x":47,"y":50},"x49y46":{"x":49,"y":46},"x48y49":{"x":48,"y":49},"x49y48":{"x":49,"y":48},"x50y51":{"x":50,"y":51},"x49y50":{"x":49,"y":50}}],
  [{"x50y52":{"x":50,"y":52},"x50y51":{"x":50,"y":51},"x52y51":{"x":52,"y":51},"x46y53":{"x":46,"y":53},"x53y47":{"x":53,"y":47},"x47y51":{"x":47,"y":51},"x53y50":{"x":53,"y":50},"x48y48":{"x":48,"y":48},"x50y49":{"x":50,"y":49},"x52y53":{"x":52,"y":53},"x49y50":{"x":49,"y":50},"x51y50":{"x":51,"y":50},"x47y48":{"x":47,"y":48},"x52y52":{"x":52,"y":52},"x51y51":{"x":51,"y":51},"x49y49":{"x":49,"y":49},"x53y48":{"x":53,"y":48},"x47y52":{"x":47,"y":52},"x50y50":{"x":50,"y":50},"x51y49":{"x":51,"y":49},"x47y46":{"x":47,"y":46},"x51y48":{"x":51,"y":48}}]
]
// up right
var dir8_bank = [
  [{"x48y50":{"x":48,"y":50},"x51y49":{"x":51,"y":49},"x48y49":{"x":48,"y":49},"x47y47":{"x":47,"y":47},"x50y46":{"x":50,"y":46},"x50y48":{"x":50,"y":48},"x50y51":{"x":50,"y":51},"x47y46":{"x":47,"y":46},"x49y49":{"x":49,"y":49},"x47y50":{"x":47,"y":50},"x49y47":{"x":49,"y":47},"x52y47":{"x":52,"y":47},"x50y47":{"x":50,"y":47},"x53y50":{"x":53,"y":50},"x52y52":{"x":52,"y":52},"x51y51":{"x":51,"y":51},"x51y52":{"x":51,"y":52},"x50y49":{"x":50,"y":49},"x53y49":{"x":53,"y":49},"x46y49":{"x":46,"y":49},"x51y48":{"x":51,"y":48},"x51y46":{"x":51,"y":46}}],
  [{"x50y49":{"x":50,"y":49},"x48y46":{"x":48,"y":46},"x52y46":{"x":52,"y":46},"x48y47":{"x":48,"y":47},"x49y46":{"x":49,"y":46},"x51y52":{"x":51,"y":52},"x47y49":{"x":47,"y":49},"x47y52":{"x":47,"y":52},"x52y53":{"x":52,"y":53},"x47y46":{"x":47,"y":46},"x53y46":{"x":53,"y":46},"x50y47":{"x":50,"y":47},"x51y53":{"x":51,"y":53},"x51y46":{"x":51,"y":46},"x50y52":{"x":50,"y":52},"x52y47":{"x":52,"y":47},"x49y53":{"x":49,"y":53},"x51y48":{"x":51,"y":48},"x52y52":{"x":52,"y":52},"x49y48":{"x":49,"y":48}}],
  [{"x49y47":{"x":49,"y":47},"x48y49":{"x":48,"y":49},"x46y53":{"x":46,"y":53},"x51y51":{"x":51,"y":51},"x52y48":{"x":52,"y":48},"x48y46":{"x":48,"y":46},"x52y52":{"x":52,"y":52},"x51y47":{"x":51,"y":47},"x46y52":{"x":46,"y":52},"x53y50":{"x":53,"y":50},"x46y50":{"x":46,"y":50},"x53y48":{"x":53,"y":48},"x52y46":{"x":52,"y":46},"x48y52":{"x":48,"y":52},"x49y48":{"x":49,"y":48},"x49y53":{"x":49,"y":53},"x52y53":{"x":52,"y":53},"x50y46":{"x":50,"y":46},"x52y50":{"x":52,"y":50},"x46y47":{"x":46,"y":47},"x49y52":{"x":49,"y":52}}]
]

function getStart(angle){
  //right
  if (angle > -Math.PI / 8 && angle < 0 || angle > 0 && angle < Math.PI / 8) {
    game.bomb_init(dir1_bank[Math.floor(Math.random()*dir1_bank.length)]);
  }
  //down right
  else if (angle > Math.PI / 8 && angle < 3 * Math.PI / 8) {
    game.bomb_init(dir2_bank[Math.floor(Math.random()*dir2_bank.length)]);
  }
  //down
  else if (angle > 3 * Math.PI / 8 && angle < 5 * Math.PI / 8) {
    game.bomb_init(dir3_bank[Math.floor(Math.random()*dir3_bank.length)]);
  }
  //down left
  else if (angle > 5 * Math.PI / 8 && angle < 7 * Math.PI / 8) {
    game.bomb_init(dir4_bank[Math.floor(Math.random()*dir4_bank.length)]);
  }
  //left
  else if (angle < Math.PI && angle > 7 * Math.PI / 8 || angle > -Math.PI && angle < -7 * Math.PI / 8) {
    game.bomb_init(dir5_bank[Math.floor(Math.random()*dir5_bank.length)]);
  }
  //up left
  else if (angle > -7 * Math.PI / 8 && angle < -5 * Math.PI / 8) {
    game.bomb_init(dir6_bank[Math.floor(Math.random()*dir6_bank.length)]);
  }
  //up
  else if (angle > -5 * Math.PI / 8 && angle < -3 * Math.PI / 8) {
    game.bomb_init(dir7_bank[Math.floor(Math.random()*dir7_bank.length)]);
  }
  //up right
  else if (angle > -3 * Math.PI / 8 && angle < -Math.PI / 8) {
    game.bomb_init(dir8_bank[Math.floor(Math.random()*dir8_bank.length)]);
  }
}

function currentState(socket_id) {
  if (!game.individual_client_objects[socket_id]) return {};
  const state = {
    players: game.individual_client_objects[socket_id].players,
    objects: game.individual_client_objects[socket_id].objects,
    time: Date.now(),
    bombs: game.bomb,
    top: game.top_scores
  }
  return state;
}

setInterval(function () {
  if (num_users) {
    // console.time("update");
    game.update();
    // console.timeEnd("update");
    // console.time("Send Socket");
    let sockets = io.sockets.sockets;
    for (let id in sockets) {
      let socket = sockets[id];
      let update = currentState(socket.id);
      if (game.individual_client_objects[socket.id]) {
        // console.log("Players: ", Object.keys(update.players).length,
        //   "Objects: ", Object.keys(update.objects).length);
        io.to(socket.id).emit('state', update);
      }
    }
  }
}, 1000/120);